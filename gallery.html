<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>12 Pubs Photos</title>
  <link rel="stylesheet" href="mystyle.css">

  <style>
    body { background:#f6f7fb; margin:0; }
    .page { padding: 14px; max-width: 980px; margin: 0 auto; }

    .topbar{
      position: sticky;
      top: 0;
      z-index: 9999;
      background: rgba(246,247,251,.95);
      backdrop-filter: blur(6px);
      padding: 10px 0;
      display:flex;
      align-items:center;
      gap: 10px;
    }

    .backbtn{
      display:inline-flex;
      align-items:center;
      gap: 8px;
      border: 1px solid rgba(0,0,0,.12);
      background:#fff;
      padding: 10px 12px;
      border-radius: 12px;
      font-weight: 800;
      cursor:pointer;
      text-decoration:none;
      color:#111827;
      box-shadow: 0 8px 24px rgba(0,0,0,.10);
    }

    .title{ font-weight: 900; font-size: 16px; margin: 0; }
    .sub{ margin: 0; color:#56606a; font-size: 12px; }

    /* ✅ 1 per row on mobile, ✅ 2 per row on desktop */
    .pub-grid{
      display:grid;
      grid-template-columns: 1fr;
      gap: 14px;
      margin-top: 12px;
    }
    @media (min-width: 720px){
      .pub-grid{ grid-template-columns: repeat(2, 1fr); }
    }

    .pub-card{
      background:#fff;
      border: 1px solid rgba(0,0,0,.10);
      border-radius: 16px;
      box-shadow: 0 10px 26px rgba(0,0,0,.12);
      padding: 12px;
    }

    .pub-head{
      display:flex;
      justify-content: space-between;
      align-items:flex-start;
      gap: 10px;
      margin-bottom: 10px;
    }

    .pub-name{
      margin: 0;
      font-size: 14px;
      font-weight: 900;
      line-height: 1.2;
    }

    .pub-filehint{
      font-size: 11px;
      color:#64748b;
      font-weight: 800;
      white-space: nowrap;
    }

    /* Frame area */
    .frame{
      position: relative;
      border-radius: 16px;
      overflow: hidden;
      background: #f1f5f9;
      border: 1px solid rgba(0,0,0,.10);
      aspect-ratio: 4 / 3;
      cursor: pointer;
    }

    .frame .photo{
      width:100%;
      height:100%;
      object-fit: cover;
      display:block;
    }

    .frame .overlay{
      position:absolute;
      inset:0;
      width:100%;
      height:100%;
      object-fit: cover;
      pointer-events:none;
      user-select:none;
    }

    .missing{
      position:absolute;
      inset:0;
      display:flex;
      align-items:center;
      justify-content:center;
      padding: 14px;
      text-align:center;
      color:#64748b;
      font-weight: 900;
      font-size: 13px;
      line-height: 1.25;
    }

    /* Bottom random carousel (normal section) */
    .random-section{
      margin-top: 18px;
      padding-bottom: 18px;
    }

    .random-card{
      background:#fff;
      border-radius: 16px;
      border: 1px solid rgba(0,0,0,.10);
      box-shadow: 0 10px 30px rgba(0,0,0,.16);
      padding: 10px;
    }

    .random-head{
      display:flex;
      align-items:center;
      justify-content: space-between;
      gap: 10px;
      margin-bottom: 8px;
    }

    .random-title{
      font-weight: 900;
      font-size: 14px;
      margin: 0;
    }

    .random-hint{
      font-size: 11px;
      color:#64748b;
      font-weight: 800;
      white-space: nowrap;
    }

    .random-main{
      position: relative;
      border-radius: 14px;
      overflow: hidden;
      border: 1px solid rgba(0,0,0,.10);
      height: 190px;
      background: #f1f5f9;
      display:flex;
      align-items:center;
      justify-content:center;
      cursor:pointer;
    }
    .random-main img{
      width:100%;
      height:100%;
      object-fit: cover;
      display:none;
    }
    .random-empty{
      color:#64748b;
      font-weight: 900;
      text-align:center;
      padding: 12px;
    }

    .navbtn{
      position:absolute;
      top:50%;
      transform: translateY(-50%);
      width: 36px;
      height: 36px;
      border-radius: 999px;
      border: none;
      background: rgba(0,0,0,.45);
      color: #fff;
      font-weight: 900;
      cursor: pointer;
      z-index: 5;
    }
    .navbtn.prev{ left: 8px; }
    .navbtn.next{ right: 8px; }

    .random-strip{
      display:flex;
      gap: 6px;
      margin-top: 10px;
      overflow-x: auto;
      padding-bottom: 4px;
    }
    .random-strip::-webkit-scrollbar{ height: 6px; }
    .random-strip::-webkit-scrollbar-thumb{ background: rgba(0,0,0,.20); border-radius: 999px; }

    /* smaller thumbs */
    .rthumb{
      flex: 0 0 auto;
      width: 54px;
      height: 40px;
      border-radius: 10px;
      overflow:hidden;
      border: 1px solid rgba(0,0,0,.10);
      background:#fff;
      cursor:pointer;
    }
    @media (min-width: 720px){
      .rthumb{ width: 70px; height: 54px; }
    }

    .rthumb img{ width:100%; height:100%; object-fit: cover; display:block; }
    .rthumb.active{ outline: 3px solid rgba(124,58,237,.55); }

    /* Fullscreen modal */
    .modal{
      position: fixed;
      inset: 0;
      background: rgba(0,0,0,.92);
      z-index: 20000;
      display:none;
      align-items:center;
      justify-content:center;
      padding: 16px;
    }
    .modal.open{ display:flex; }

    .modal img{
      max-width: 100%;
      max-height: 100%;
      border-radius: 16px;
    }

    .modal-close{
      position: fixed;
      top: 12px;
      right: 12px;
      width: 44px;
      height: 44px;
      border-radius: 12px;
      border: none;
      background: rgba(255,255,255,.12);
      color: #fff;
      font-size: 20px;
      font-weight: 900;
      cursor: pointer;
    }
  </style>
</head>

<body>
  <div class="page">
    <div class="topbar">
      <a class="backbtn" href="index.html">← Back to Map</a>
      <div>
        <p class="title">12 Pubs Photos</p>
        <p class="sub">Upload files into GitHub. Tap any image to view fullscreen.</p>
      </div>
    </div>

    <!-- ✅ 12 pubs grid -->
    <div id="pubGrid" class="pub-grid"></div>

    <!-- ✅ Random carousel at bottom (static from GitHub) -->
    <div class="random-section">
      <div class="random-card">
        <div class="random-head">
          <p class="random-title">Random Pics Carousel</p>
          <div class="random-hint">photos/random/r1.jpg, r2.jpg…</div>
        </div>

        <!-- MAIN (big) image -->
        <div id="randomMain" class="random-main" title="Tap to fullscreen">
          <div id="randomEmpty" class="random-empty">No random pics found yet.<br/>Add photos/random/r1.jpg etc.</div>
          <button id="prevRandom" class="navbtn prev" type="button" aria-label="Previous">‹</button>
          <button id="nextRandom" class="navbtn next" type="button" aria-label="Next">›</button>
          <img id="randomMainImg" alt="Random photo"/>
        </div>

        <!-- THUMBNAILS (small) underneath -->
        <div id="randomStrip" class="random-strip"></div>
      </div>
    </div>
  </div>

  <!-- Fullscreen modal -->
  <div id="modal" class="modal" aria-hidden="true">
    <button id="modalClose" class="modal-close" type="button" aria-label="Close">✕</button>
    <img id="modalImg" alt="Photo"/>
  </div>

<script>
  // Pub list
  const PUBS = [
    {n:1,  name:"The Wild Duck"},
    {n:2,  name:"Tapped Late Bar & Kitchen"},
    {n:3,  name:"Pygmalion"},
    {n:4,  name:"The Bar With No Name"},
    {n:5,  name:"The Hairy Lemon"},
    {n:6,  name:"Café en Seine"},
    {n:7,  name:"37 Dawson Street"},
    {n:8,  name:"Flight Club Dublin"},
    {n:9,  name:"Whelan's"},
    {n:10, name:"The Camden"},
    {n:11, name:"Devitt's Pub"},
    {n:12, name:"The Bleeding Horse"},
  ];

  // Frame files (rotate them)
  const FRAMES = [
    "frames/frame1.png",
    "frames/frame2.png",
    "frames/frame3.png",
    "frames/frame4.png",
  ];

  // Image extensions to try
  const EXTS = ["jpg", "jpeg", "png", "webp"];

  // Pub photos base path
  const PUB_BASE = "photos/pubs/pub";     // pub1.jpg etc
  const RANDOM_BASE = "photos/random/r";  // r1.jpg etc

  // Random scanning settings (so you can just upload r1, r2, r3...)
  const RANDOM_MAX = 80;                 // tries up to r80.*
  const RANDOM_STOP_AFTER_MISSES = 10;   // stop after 10 in a row missing

  // ---------- Fullscreen modal ----------
  const modal = document.getElementById("modal");
  const modalImg = document.getElementById("modalImg");
  const modalClose = document.getElementById("modalClose");

  function openModal(src){
    modalImg.src = src;
    modal.classList.add("open");
    modal.setAttribute("aria-hidden", "false");
    if (modal.requestFullscreen) modal.requestFullscreen().catch(()=>{});
  }

  function closeModal(){
    modal.classList.remove("open");
    modal.setAttribute("aria-hidden", "true");
    modalImg.src = "";
    if (document.fullscreenElement) document.exitFullscreen().catch(()=>{});
  }

  modalClose.addEventListener("click", closeModal);
  modal.addEventListener("click", (e) => { if (e.target === modal) closeModal(); });
  document.addEventListener("keydown", (e) => { if (e.key === "Escape") closeModal(); });

  // ---------- Helpers ----------
  function setFirstAvailable(imgEl, missingEl, base, exts){
    let i = 0;
    const tryNext = () => {
      if (i >= exts.length){
        imgEl.style.display = "none";
        if (missingEl) missingEl.style.display = "flex";
        return;
      }
      imgEl.src = `${base}.${exts[i++]}`;
    };

    imgEl.onload = () => {
      imgEl.style.display = "block";
      if (missingEl) missingEl.style.display = "none";
    };
    imgEl.onerror = tryNext;

    tryNext();
  }

  function probeUrl(url){
    return new Promise((resolve) => {
      const img = new Image();
      img.onload = () => resolve(url);
      img.onerror = () => resolve(null);
      img.src = url;
    });
  }

  async function findFirstAvailableUrl(base, exts){
    for (const ext of exts){
      const u = `${base}.${ext}`;
      const ok = await probeUrl(u);
      if (ok) return ok;
    }
    return null;
  }

  // ---------- Build pub grid ----------
  const pubGrid = document.getElementById("pubGrid");

  function pubCardHTML(p){
    const frameSrc = FRAMES[(p.n - 1) % FRAMES.length];
    return `
      <div class="pub-card" data-pub="${p.n}">
        <div class="pub-head">
          <h3 class="pub-name">${p.n}. ${p.name}</h3>
          <div class="pub-filehint">pub${p.n}.jpg</div>
        </div>

        <div class="frame" role="button" tabindex="0" aria-label="Open photo fullscreen">
          <img class="photo" alt="Pub ${p.n} photo" />
          <div class="missing">Upload<br><b>photos/pubs/pub${p.n}.jpg</b></div>
          <img class="overlay" alt="" aria-hidden="true" src="${frameSrc}" />
        </div>
      </div>
    `;
  }

  function mountPubs(){
    pubGrid.innerHTML = PUBS.map(pubCardHTML).join("");

    pubGrid.querySelectorAll(".pub-card").forEach(card => {
      const n = Number(card.dataset.pub);
      const frame = card.querySelector(".frame");
      const img = card.querySelector(".photo");
      const missing = card.querySelector(".missing");

      setFirstAvailable(img, missing, `${PUB_BASE}${n}`, EXTS);

      const open = () => {
        if (!img.src || img.style.display === "none") return;
        openModal(img.src);
      };

      frame.addEventListener("click", open);
      frame.addEventListener("keydown", (e) => {
        if (e.key === "Enter" || e.key === " ") open();
      });
    });
  }

  // ---------- Random carousel (STATIC FROM GITHUB) ----------
  const randomStrip = document.getElementById("randomStrip");
  const randomMain = document.getElementById("randomMain");
  const randomMainImg = document.getElementById("randomMainImg");
  const randomEmpty = document.getElementById("randomEmpty");
  const prevRandom = document.getElementById("prevRandom");
  const nextRandom = document.getElementById("nextRandom");

  let randomUrls = [];
  let randomIdx = 0;

  function renderRandom(){
    if (!randomUrls.length){
      randomMainImg.style.display = "none";
      randomEmpty.style.display = "block";

      // ✅ show placeholder thumbs so you can see the strip even before uploads
      randomStrip.innerHTML = Array.from({length:10}).map(() =>
        `<div class="rthumb" style="opacity:.35;background:#e2e8f0"></div>`
      ).join("");

      return;
    }

    if (randomIdx >= randomUrls.length) randomIdx = randomUrls.length - 1;
    if (randomIdx < 0) randomIdx = 0;

    randomMainImg.src = randomUrls[randomIdx];
    randomMainImg.style.display = "block";
    randomEmpty.style.display = "none";

    randomStrip.innerHTML = randomUrls.map((u, i) => `
      <div class="rthumb ${i===randomIdx ? "active":""}" data-i="${i}">
        <img src="${u}" alt="random ${i+1}">
      </div>
    `).join("");

    randomStrip.onclick = (e) => {
      const t = e.target.closest(".rthumb");
      if (!t || t.dataset.i === undefined) return;
      randomIdx = Number(t.dataset.i);
      renderRandom();
    };
  }

  async function loadRandomFromRepo(){
    randomUrls = [];
    let misses = 0;

    for (let i = 1; i <= RANDOM_MAX; i++){
      const base = `${RANDOM_BASE}${i}`;
      const url = await findFirstAvailableUrl(base, EXTS);

      if (url){
        randomUrls.push(url);
        misses = 0;
      } else {
        misses++;
        if (misses >= RANDOM_STOP_AFTER_MISSES) break;
      }
    }

    renderRandom();
  }

  prevRandom.addEventListener("click", (e) => {
    e.stopPropagation();
    if (!randomUrls.length) return;
    randomIdx = (randomIdx - 1 + randomUrls.length) % randomUrls.length;
    renderRandom();
  });

  nextRandom.addEventListener("click", (e) => {
    e.stopPropagation();
    if (!randomUrls.length) return;
    randomIdx = (randomIdx + 1) % randomUrls.length;
    renderRandom();
  });

  randomMain.addEventListener("click", () => {
    if (!randomUrls.length) return;
    openModal(randomUrls[randomIdx]);
  });

  // ---------- Init ----------
  mountPubs();
  loadRandomFromRepo();
</script>
</body>
</html>
